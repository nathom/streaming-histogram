[tox]
min_version = 4.11
requires =
    tox>=4.11
    tox-uv>=1.9
env_list =
    py310-np{min,2}
    py311-np{min,2}
    py312-np{latest,2}
    py313-np{latest,2}
    py314-np{latest,2}

[testenv:bench]
description = Build the extension with release optimizations, then run Python benchmarks
basepython = python3.12
deps =
    maturin>=1.6,<2.0
    numpy>=2.0,<3.0
    psutil>=5.9
commands_pre =
    maturin develop --locked --release
commands =
    python benchmarks/accumulate_chunks.py {posargs}

[testenv]
description = Build the extension with maturin and run pytest against numpy constraint {env_name}
package = skip
deps =
    maturin>=1.6,<2.0
    pytest>=8.0
    npmin: numpy>=1.24,<1.25
    nplatest: numpy>=1.26,<2.0
    np2: numpy>=2.0,<3.0
commands_pre =
    maturin develop --locked
commands =
    pytest {posargs:tests}
pass_env =
    CARGO_HOME
    RUSTUP_HOME
    RUSTFLAGS
    CC
    CXX
    TARGET
    OPENSSL_DIR
setenv =
    PYTHONDONTWRITEBYTECODE = 1
